setcps(0.28);

stack(
  // 1. 低音：像深海的呼吸，保持极简
  note("<a1 f1 c1 g0>")
    .s("piano")
    .gain(0.25) // 稍微降低音量
    .slow(1.1)
    .lpf(800) // 压得更闷一点，给上面的声部留出空间
    .room(0.5)
    ._scope(),

  // 2. 和弦：它是“背景”，不能抢戏
  note("<[a2,e3,a3,c4] [f2,c3,f3,a3] [c2,g3,c4,e4] [g2,d3,g3,b3]>")
    .s("piano")
    .struct("1(3,8)")
    .velocity(0.35) // 降低触键力度，听起来更温柔
    .gain(0.45) // 显著降低这一层的增益，让它退到后面去
    .room(0.6)
    .hpf(200) // 切掉和弦的低频，防止和低音层打架
    .slow(2.6)
    ._scope(),

  // 3. 旋律：它是主角，但需要“空气感”
  note("~ c5 ~ b4 ~ [a4,e5] ~ ~ | ~ e5 ~ g5 ~ d5 ~ ~")
    .s("piano")
    .velocity(perlin.range(0.3, 0.5))
    .room(0.8) // 旋律可以保持较高的空间感
    .delay(0.6)
    .delayfb(0.3) // 稍微降低一点反馈(fb)，防止回声堆积
    .hpf(500) // 让旋律听起来更清脆、空灵
    .pan(0.3)
    ._scope(),

  // 4. 点缀层：修复“吵闹”的根源
  note("[a3*2 ~ ~ b3*1] [c4*3 ~ b3*1] [~ d4*1 c4*2 g#3*1] [a3*4]")
    .s("piano")
    .velocity(rand.range(0.2, 0.3)) // 降低力度
    .gain(0.4) // 降低增益
    .room(0.5) // 减小空间，不要让它漫出来
    .size(0.5) // 减小房间尺寸
    .lpf(1200)
    .detune(2) // 减小失调值，让它听起来是“忧郁”而不是“走音”
    .nudge(0.1)
    .fast(0.1)
    .hpf(400) // 同样做高通处理
    ._scope(),
);
